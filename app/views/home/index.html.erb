<!-- app/views/home/index.html.erb -->
<h1>Welcome to our website!</h1>

<div id="map" style="height: 400px;"></div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    fetch('/authors.json')
      .then(response => response.json())
      .then(authors => {
        // Initialize Map Box Static Map API
        const mapBoxApiKey = '<%= Rails.application.credentials.dig(:map_box, :api_key) %>';
        const mapElement = document.getElementById('map');
        const markers = authors.map(author => ({
          coordinates: `${author.longitude},${author.latitude}`,
          title: author.name
        }));

        const mapUrl = `https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/pin-s+000(${markers.join(',')})/${markers.join(',')},10/800x400?access_token=${mapBoxApiKey}`;

        mapElement.innerHTML = `<img src="${mapUrl}" alt="Map of Author Locations">`;
      })
      .catch(error => console.error('Error fetching authors:', error));
  });
</script>
